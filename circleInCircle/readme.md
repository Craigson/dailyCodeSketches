sorry this is kind of a mess. the key part is in the draw function, all the blob and shader stuff isn't used here. 

